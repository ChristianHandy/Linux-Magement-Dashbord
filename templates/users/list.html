<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/static/style.css">

<div class="container">
  <h2>User Management</h2>
  <p>
    <a class="btn" href="/index">Back to Main Menu</a>
    <a class="btn" href="/users/add">Add New User</a>
  </p>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for message in messages %}
        <div class="alert">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h3>Existing Users</h3>
  {% if users %}
    {% for user in users %}
      <div class="card">
        <b>{{ user.username }}</b>
        {% if not user.active %}
          <span style="color: red;">(Inactive)</span>
        {% endif %}
        <br>
        {% if user.email %}
          Email: {{ user.email }}<br>
        {% endif %}
        Roles: 
        {% if user.id in roles_by_user %}
          {{ roles_by_user[user.id]|join(', ') }}
        {% else %}
          <em>None</em>
        {% endif %}
        <br>
        Created: {{ user.created_at }}<br><br>
        <a class="btn" href="/users/edit/{{ user.id }}">Edit</a>
        <form action="/users/delete/{{ user.id }}" method="post" style="display:inline">
          <button class="btn" type="submit" onclick="return confirm('Are you sure you want to delete this user?')">Delete</button>
        </form>
      </div>
    {% endfor %}
  {% else %}
    <p>No users found.</p>
  {% endif %}
</div>
